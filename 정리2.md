1ï¸âƒ£ Pytest ì„¤ì¹˜ ë° ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
ì„¤ì¹˜
poetry add --group=dev pytest==8.3.4

í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±

test_simple.py ìƒì„± í›„:

def test_simple() -> None:
    print("test")


ì¢Œì¸¡ ì´ˆë¡ìƒ‰ ë²„íŠ¼ í´ë¦­ â†’ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

í„°ë¯¸ë„ ì‹¤í–‰:

pytest .

ì •ìƒ ì¶œë ¥ ì˜ˆì‹œ
collected 1 item
test_simple.py .  [100%]

1 passed in 0.01s

ì—ëŸ¬ ë°œìƒ ì˜ˆì‹œ
def test_simple() -> None:
    1 / 0

E   ZeroDivisionError: division by zero

ì˜ˆì™¸ ì²˜ë¦¬
def test_simple() -> None:
    try:
        1 / 0
    except ZeroDivisionError:
        print("ì¡ì•˜ë‹¤!")


ì‹¤í–‰ ê²°ê³¼: í…ŒìŠ¤íŠ¸ í†µê³¼, ì˜ˆìƒ ê°€ëŠ¥í•œ ì˜ˆì™¸ ì²˜ë¦¬ ì™„ë£Œ

2ï¸âƒ£ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ì™€ assert ì‚¬ìš©
ì œí’ˆ ì½”ë“œ ì˜ˆì‹œ

temp.py

def add(a: int, b: int) -> int:
    return a + b

def mul(a: int, b: int) -> int:
    return a * b

í…ŒìŠ¤íŠ¸ ì½”ë“œ ì˜ˆì‹œ

test_temp.py

from temp import add

def test_add() -> None:
    # Given
    a, b = 1, 1
    # When
    result = add(a, b)
    # Then
    assert result == 2


pytestë¡œ ì‹¤í–‰ â†’ í…ŒìŠ¤íŠ¸ í†µê³¼ ì—¬ë¶€ í™•ì¸

assert ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë°œìƒ

3ï¸âƒ£ Coverage ì„¤ì¹˜ ë° ì‚¬ìš©
ì„¤ì¹˜
poetry add --group=dev coverage==7.6.9

ì‹¤í–‰
poetry run coverage run -m pytest test_temp.py
poetry run coverage report -m

ì¶œë ¥ ì˜ˆì‹œ
Name        Stmts  Miss  Cover   Missing
----------------------------------------
temp.py       4      1   75%      5
TOTAL         4      1   75%


**Stmts

ë‚˜ì˜ ë§:
ì •ë¦¬í•œê±¸ read.me ì½”ë“œë¡œ ë°”ê¿”ì¤˜
ChatGPTì˜ ë§:

ì˜ˆ í˜•ë‹˜ ğŸ˜ ì§€ê¸ˆê¹Œì§€ ì •ë¦¬í•œ ë‚´ìš©ì„ ê¹”ë”í•˜ê²Œ README.md í˜•ì‹ìœ¼ë¡œ ë°”ê¿”ì„œ ë³´ì—¬ë“œë¦´ê²Œìš”. ë§ˆí¬ë‹¤ìš´ ë¬¸ë²• + ì½”ë“œ ë¸”ë¡ í¬í•¨í•´ì„œ GitHubì—ì„œ ë°”ë¡œ ì“°ê¸° ì¢‹ê²Œ í–ˆìŠµë‹ˆë‹¤.

# FastAPI í”„ë¡œì íŠ¸ í…ŒìŠ¤íŠ¸ & CI ê°€ì´ë“œ

## 1ï¸âƒ£ Pytest ì„¤ì¹˜ ë° ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

### ì„¤ì¹˜
```bash
poetry add --group=dev pytest==8.3.4

í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±

test_simple.py ìƒì„± í›„:

def test_simple() -> None:
    print("test")


ì¢Œì¸¡ ì´ˆë¡ìƒ‰ ë²„íŠ¼ í´ë¦­ â†’ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

í„°ë¯¸ë„ ì‹¤í–‰:

pytest .

ì •ìƒ ì¶œë ¥ ì˜ˆì‹œ
collected 1 item
test_simple.py .  [100%]

1 passed in 0.01s

ì—ëŸ¬ ë°œìƒ ì˜ˆì‹œ
def test_simple() -> None:
    1 / 0

E   ZeroDivisionError: division by zero

ì˜ˆì™¸ ì²˜ë¦¬
def test_simple() -> None:
    try:
        1 / 0
    except ZeroDivisionError:
        print("ì¡ì•˜ë‹¤!")


ì‹¤í–‰ ê²°ê³¼: í…ŒìŠ¤íŠ¸ í†µê³¼, ì˜ˆìƒ ê°€ëŠ¥í•œ ì˜ˆì™¸ ì²˜ë¦¬ ì™„ë£Œ

2ï¸âƒ£ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ì™€ assert ì‚¬ìš©
ì œí’ˆ ì½”ë“œ ì˜ˆì‹œ (temp.py)
def add(a: int, b: int) -> int:
    return a + b

def mul(a: int, b: int) -> int:
    return a * b

í…ŒìŠ¤íŠ¸ ì½”ë“œ ì˜ˆì‹œ (test_temp.py)
from temp import add

def test_add() -> None:
    # Given
    a, b = 1, 1
    # When
    result = add(a, b)
    # Then
    assert result == 2


pytest ì‹¤í–‰ â†’ í…ŒìŠ¤íŠ¸ í†µê³¼ ì—¬ë¶€ í™•ì¸

assert ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë°œìƒ

3ï¸âƒ£ Coverage ì„¤ì¹˜ ë° ì‚¬ìš©
ì„¤ì¹˜
poetry add --group=dev coverage==7.6.9

ì‹¤í–‰
poetry run coverage run -m pytest test_temp.py
poetry run coverage report -m

ì¶œë ¥ ì˜ˆì‹œ
Name        Stmts  Miss  Cover   Missing
----------------------------------------
temp.py       4      1   75%      5
TOTAL         4      1   75%


Stmts: ì´ ì½”ë“œ ë¼ì¸ ìˆ˜

Miss: ì‹¤í–‰ë˜ì§€ ì•Šì€ ë¼ì¸

Missing: ì‹¤í–‰ë˜ì§€ ì•Šì€ ë¼ì¸ ë²ˆí˜¸

HTML ë³´ê³ ì„œ
poetry run coverage html


htmlcov/index.htmlì—ì„œ ë¸Œë¼ìš°ì €ë¡œ ì‹œê°í™” ê°€ëŠ¥

4ï¸âƒ£ Dev Dependency
êµ¬ë¶„	ì‚¬ìš© ì‹œì 	ì˜ˆì‹œ
Main / Runtime	ì„œë²„ ì‹¤í–‰ ì¤‘	fastapi, uvicorn, pydantic
Dev / Development	ê°œë°œ ì¤‘ë§Œ	black, ruff, mypy, pytest, coverage
ì„¤ì¹˜ ì˜ˆì‹œ
poetry install --no-root --only main


--no-root: í”„ë¡œì íŠ¸ ìì²´ ì„¤ì¹˜ ì•ˆí•¨

--only main: dev group ì œì™¸, mainë§Œ ì„¤ì¹˜

5ï¸âƒ£ Github Actions CI ì˜ˆì‹œ
name: CI

on:
  push:
  pull_request:

jobs:
  static-analysis:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - run: curl -sSL https://install.python-poetry.org | python3 - --version 1.8.5

      - run: |
          echo "${HOME}/.local/bin" >> $GITHUB_PATH
          echo "${HOME}/.poetry/bin" >> $GITHUB_PATH

      - run: poetry config virtualenvs.in-project true

      - uses: actions/cache@v4
        with:
          path: |
            .venv
            ~/.cache/pypoetry
            ~/.cache/pip
          key: ${{ runner.os }}-py${{ steps.setup-python.outputs.python-version }}-${{ hashFiles('**/poetry.lock') }}
          restore-keys: |
            ${{ runner.os }}-py${{ steps.setup-python.outputs.python-version }}-

      - run: poetry install --no-root --no-interaction
      - run: poetry run black . --check
      - run: |
          poetry run ruff check --select I .
          poetry run ruff check .
      - run: poetry run mypy .

  test:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.13"
      - run: curl -sSL https://install.python-poetry.org | python3 - --version 1.8.5
      - run: |
          echo "${HOME}/.local/bin" >> $GITHUB_PATH
          echo "${HOME}/.poetry/bin" >> $GITHUB_PATH
      - run: poetry config virtualenvs.in-project true
      - uses: actions/cache@v4
        with:
          path: |
            .venv
            ~/.cache/pypoetry
            ~/.cache/pip
          key: ${{ runner.os }}-py${{ steps.setup-python.outputs.python-version }}-${{ hashFiles('**/poetry.lock') }}
          restore-keys: |
            ${{ runner.os }}-py${{ steps.setup-python.outputs.python-version }}-
      - run: poetry install --no-root --no-interaction
      - run: |
          poetry run coverage run -m pytest .
          poetry run coverage report -m
          poetry run coverage xml -o coverage.xml
      - uses: actions/upload-artifact@v4
        with:
          name: coverage-xml
          path: coverage.xml


âœ… ì´ë ‡ê²Œ êµ¬ì„±í•˜ë©´:

ì½”ë“œ í¬ë§·, ë¦°íŠ¸, íƒ€ì…ì²´í¬, í…ŒìŠ¤íŠ¸, ì»¤ë²„ë¦¬ì§€ê¹Œì§€ í•œ ë²ˆì— CIì—ì„œ ê²€ì¦ ê°€ëŠ¥

Dev dependency ë¶„ë¦¬ë¡œ Docker/ë°°í¬ ì‹œ ë¶ˆí•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ ë°©ì§€

PR ìƒì„±/ë™ê¸°í™” ì‹œì—ë„ ìë™ìœ¼ë¡œ CI ë™ì‘
