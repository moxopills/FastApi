1️⃣ Pytest 설치 및 단위 테스트
설치
poetry add --group=dev pytest==8.3.4

테스트 파일 생성

test_simple.py 생성 후:

def test_simple() -> None:
    print("test")


좌측 초록색 버튼 클릭 → 테스트 실행

터미널 실행:

pytest .

정상 출력 예시
collected 1 item
test_simple.py .  [100%]

1 passed in 0.01s

에러 발생 예시
def test_simple() -> None:
    1 / 0

E   ZeroDivisionError: division by zero

예외 처리
def test_simple() -> None:
    try:
        1 / 0
    except ZeroDivisionError:
        print("잡았다!")


실행 결과: 테스트 통과, 예상 가능한 예외 처리 완료

2️⃣ 함수 테스트와 assert 사용
제품 코드 예시

temp.py

def add(a: int, b: int) -> int:
    return a + b

def mul(a: int, b: int) -> int:
    return a * b

테스트 코드 예시

test_temp.py

from temp import add

def test_add() -> None:
    # Given
    a, b = 1, 1
    # When
    result = add(a, b)
    # Then
    assert result == 2


pytest로 실행 → 테스트 통과 여부 확인

assert 실패 시 에러 발생

3️⃣ Coverage 설치 및 사용
설치
poetry add --group=dev coverage==7.6.9

실행
poetry run coverage run -m pytest test_temp.py
poetry run coverage report -m

출력 예시
Name        Stmts  Miss  Cover   Missing
----------------------------------------
temp.py       4      1   75%      5
TOTAL         4      1   75%


**Stmts


# FastAPI 프로젝트 테스트 & CI 가이드

## 1️⃣ Pytest 설치 및 단위 테스트

### 설치
```bash
poetry add --group=dev pytest==8.3.4

테스트 파일 생성

test_simple.py 생성 후:

def test_simple() -> None:
    print("test")


좌측 초록색 버튼 클릭 → 테스트 실행

터미널 실행:

pytest .

정상 출력 예시
collected 1 item
test_simple.py .  [100%]

1 passed in 0.01s

에러 발생 예시
def test_simple() -> None:
    1 / 0

E   ZeroDivisionError: division by zero

예외 처리
def test_simple() -> None:
    try:
        1 / 0
    except ZeroDivisionError:
        print("잡았다!")


실행 결과: 테스트 통과, 예상 가능한 예외 처리 완료

2️⃣ 함수 테스트와 assert 사용
제품 코드 예시 (temp.py)
def add(a: int, b: int) -> int:
    return a + b

def mul(a: int, b: int) -> int:
    return a * b

테스트 코드 예시 (test_temp.py)
from temp import add

def test_add() -> None:
    # Given
    a, b = 1, 1
    # When
    result = add(a, b)
    # Then
    assert result == 2


pytest 실행 → 테스트 통과 여부 확인

assert 실패 시 에러 발생

3️⃣ Coverage 설치 및 사용
설치
poetry add --group=dev coverage==7.6.9

실행
poetry run coverage run -m pytest test_temp.py
poetry run coverage report -m

출력 예시
Name        Stmts  Miss  Cover   Missing
----------------------------------------
temp.py       4      1   75%      5
TOTAL         4      1   75%


Stmts: 총 코드 라인 수

Miss: 실행되지 않은 라인

Missing: 실행되지 않은 라인 번호

HTML 보고서
poetry run coverage html


htmlcov/index.html에서 브라우저로 시각화 가능

4️⃣ Dev Dependency
구분	사용 시점	예시
Main / Runtime	서버 실행 중	fastapi, uvicorn, pydantic
Dev / Development	개발 중만	black, ruff, mypy, pytest, coverage
설치 예시
poetry install --no-root --only main


--no-root: 프로젝트 자체 설치 안함

--only main: dev group 제외, main만 설치

5️⃣ Github Actions CI 예시
name: CI

on:
  push:
  pull_request:

jobs:
  static-analysis:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - run: curl -sSL https://install.python-poetry.org | python3 - --version 1.8.5

      - run: |
          echo "${HOME}/.local/bin" >> $GITHUB_PATH
          echo "${HOME}/.poetry/bin" >> $GITHUB_PATH

      - run: poetry config virtualenvs.in-project true

      - uses: actions/cache@v4
        with:
          path: |
            .venv
            ~/.cache/pypoetry
            ~/.cache/pip
          key: ${{ runner.os }}-py${{ steps.setup-python.outputs.python-version }}-${{ hashFiles('**/poetry.lock') }}
          restore-keys: |
            ${{ runner.os }}-py${{ steps.setup-python.outputs.python-version }}-

      - run: poetry install --no-root --no-interaction
      - run: poetry run black . --check
      - run: |
          poetry run ruff check --select I .
          poetry run ruff check .
      - run: poetry run mypy .

  test:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.13"
      - run: curl -sSL https://install.python-poetry.org | python3 - --version 1.8.5
      - run: |
          echo "${HOME}/.local/bin" >> $GITHUB_PATH
          echo "${HOME}/.poetry/bin" >> $GITHUB_PATH
      - run: poetry config virtualenvs.in-project true
      - uses: actions/cache@v4
        with:
          path: |
            .venv
            ~/.cache/pypoetry
            ~/.cache/pip
          key: ${{ runner.os }}-py${{ steps.setup-python.outputs.python-version }}-${{ hashFiles('**/poetry.lock') }}
          restore-keys: |
            ${{ runner.os }}-py${{ steps.setup-python.outputs.python-version }}-
      - run: poetry install --no-root --no-interaction
      - run: |
          poetry run coverage run -m pytest .
          poetry run coverage report -m
          poetry run coverage xml -o coverage.xml
      - uses: actions/upload-artifact@v4
        with:
          name: coverage-xml
          path: coverage.xml


✅ 이렇게 구성하면:

코드 포맷, 린트, 타입체크, 테스트, 커버리지까지 한 번에 CI에서 검증 가능

Dev dependency 분리로 Docker/배포 시 불필요한 라이브러리 설치 방지

PR 생성/동기화 시에도 자동으로 CI 동작
